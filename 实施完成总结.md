# Markdown è½¬ Word å®æ–½å®Œæˆæ€»ç»“

## âœ… å·²å®Œæˆçš„æ‰€æœ‰æ­¥éª¤

### Step 1 â€” å®‰è£…ä¾èµ– âœ…
- âœ… `docxtemplater` (^3.67.6) - å·²å®‰è£…
- âœ… `pizzip` (^3.2.0) - å·²å®‰è£…
- âœ… `markdown-it` (^14.1.0) - å·²å®‰è£…
- âœ… `html-docx-js-typescript` (^0.1.5) - å…è´¹æ›¿ä»£æ–¹æ¡ˆ
- âœ… `docx-merger` (^1.2.2) - åˆå¹¶ DOCX æ–‡ä»¶

### Step 2 â€” æ–°å¢ markdownToHtml.ts âœ…
**æ–‡ä»¶ï¼š** `netlify/functions/lib/markdownToHtml.ts`
- âœ… ä½¿ç”¨ `markdown-it` è½¬æ¢ Markdown ä¸º HTML
- âœ… æ”¯æŒåŸºç¡€ Markdown è¯­æ³•ï¼ˆæ ‡é¢˜/åˆ—è¡¨/è¡¨æ ¼/ç²—ä½“/æ¢è¡Œï¼‰
- âœ… é…ç½®ï¼š`{ html: true, linkify: true, breaks: true, typographer: true }`

### Step 3 â€” æ–°å¢ buildReportMarkdown.ts âœ…
**æ–‡ä»¶ï¼š** `netlify/functions/lib/buildReportMarkdown.ts`
- âœ… å®ç°å®Œæ•´çš„æŠ¥å‘Šç»“æ„ï¼ˆ11ä¸ªéƒ¨åˆ†ï¼‰ï¼š
  1. Purpose
  2. Executive Summaryï¼ˆåŒ…å«é£é™©ç­‰çº§ã€Key Decision Signalsã€Financial Planningï¼‰
  3. Priority è¡¨
  4. Scope/Limits
  5. Findings å¾ªç¯ï¼ˆæŒ‰ä¼˜å…ˆçº§åˆ†ç»„ï¼‰
  6. Test Data & Technical Notes
  7. Thermal Imaging
  8. CapEx
  9. Options
  10. Disclaimer
  11. Closing
- âœ… ç¡®ä¿æ‰€æœ‰å­—æ®µéƒ½æœ‰å€¼ï¼Œä¸ä¼šå‡ºç° undefined
- âœ… æ”¯æŒä» `responses.yml` è·å–è¯¦ç»†å­—æ®µ

### Step 4 â€” æ–°å¢ renderDocx.ts âœ…
**æ–‡ä»¶ï¼š** `netlify/functions/lib/renderDocx.ts`
- âœ… æ–¹æ¡ˆ Aï¼šHTML è½¬ DOCX å¹¶åˆå¹¶ï¼ˆä¿ç•™æ ¼å¼ï¼‰
- âœ… æ–¹æ¡ˆ Bï¼šHTML è½¬çº¯æ–‡æœ¬æ’å…¥ï¼ˆç®€å•ä½†ä¸¢å¤±æ ¼å¼ï¼‰
- âœ… ä¸»å‡½æ•°è‡ªåŠ¨é€‰æ‹©æ–¹æ¡ˆï¼Œå¤±è´¥æ—¶å›é€€
- âœ… ä½¿ç”¨ `docxtemplater` å¡«å……å°é¢ä¿¡æ¯
- âœ… ä½¿ç”¨ `html-docx-js-typescript` è½¬æ¢ HTML
- âœ… ä½¿ç”¨ `docx-merger` åˆå¹¶ DOCX

### Step 5 â€” æ”¹ generateWordReport âœ…
**æ–‡ä»¶ï¼š** `netlify/functions/generateWordReport.ts`
- âœ… æ–°å¢ `buildCoverData`ï¼šåªè¿”å›å°é¢ 6 ä¸ªå­—æ®µ
- âœ… é›†æˆ `buildReportMarkdown` å’Œ `markdownToHtml`
- âœ… ä½¿ç”¨ `renderDocx` æ›¿ä»£æ—§çš„ Docxtemplater æ–¹å¼
- âœ… æ”¯æŒ `report-template-md.docx`ï¼ˆä¼˜å…ˆï¼‰æˆ– `report-template.docx`ï¼ˆå›é€€ï¼‰
- âœ… **ä¿æŠ¤æœºåˆ¶**ï¼šå¦‚æœæ¨¡æ¿ä¸­æ‰¾ä¸åˆ° `{{REPORT_BODY_HTML}}`ï¼Œç›´æ¥ throw é”™è¯¯
- âœ… ä¿ç•™æ—§çš„ `buildWordTemplateData` å‡½æ•°ä»¥ä¿æŒå‘åå…¼å®¹

### Step 6 â€” éªŒæ”¶æ£€æŸ¥ âœ…
**æ–‡ä»¶ï¼š** `netlify/functions/generateWordReport.ts`
- âœ… æ·»åŠ å¼€å‘ç¯å¢ƒè°ƒè¯•æ—¥å¿—ï¼š
  - Findings countsï¼ˆimmediate/recommended/plan/limitationsï¼‰
  - Markdown é¢„è§ˆï¼ˆå‰ 1200 å­—ç¬¦ï¼‰
  - HTML é¢„è§ˆï¼ˆå‰ 1200 å­—ç¬¦ï¼‰

## ğŸ“ åˆ›å»ºçš„æ–°æ–‡ä»¶

1. `netlify/functions/lib/markdownToHtml.ts` - Markdown è½¬ HTML
2. `netlify/functions/lib/buildReportMarkdown.ts` - ç”Ÿæˆ Markdown æŠ¥å‘Š
3. `netlify/functions/lib/renderDocx.ts` - æ¸²æŸ“ DOCXï¼ˆå…è´¹æ›¿ä»£æ–¹æ¡ˆï¼‰
4. `scripts/test-markdown-report.mjs` - æµ‹è¯•è„šæœ¬
5. `scripts/generate-markdown-report.ts` - å®Œæ•´ç‰ˆæµ‹è¯•è„šæœ¬
6. `scripts/markdown-to-word.ts` - Markdown è½¬ Word å·¥å…·
7. `å…è´¹æ›¿ä»£æ–¹æ¡ˆè¯´æ˜.md` - ä½¿ç”¨è¯´æ˜
8. `ä¾èµ–å®‰è£…è¯´æ˜.md` - ä¾èµ–è¯´æ˜

## ğŸ”„ å·¥ä½œæµç¨‹

```
1. åŠ è½½ inspection æ•°æ®
   â†“
2. æ„å»º computed å­—æ®µï¼ˆRISK_RATING, OVERALL_STATUS, EXECUTIVE_SUMMARYï¼‰
   â†“
3. æ„å»º coverDataï¼ˆ6ä¸ªå°é¢å­—æ®µï¼‰
   â†“
4. ç”Ÿæˆ Markdown â†’ buildReportMarkdown()
   â†“
5. è½¬æ¢ä¸º HTML â†’ markdownToHtml()
   â†“
6. å‡†å¤‡ templateDataï¼ˆcoverData + REPORT_BODY_HTMLï¼‰
   â†“
7. åŠ è½½æ¨¡æ¿ï¼ˆä¼˜å…ˆ report-template-md.docxï¼‰
   â†“
8. æ£€æŸ¥æ¨¡æ¿æ˜¯å¦åŒ…å« {{REPORT_BODY_HTML}}ï¼ˆä¿æŠ¤æœºåˆ¶ï¼‰
   â†“
9. æ¸²æŸ“ Word â†’ renderDocx()
   â†“
10. ä¿å­˜åˆ° Netlify Blob
```

## ğŸ¯ ä¼˜åŠ¿

1. **å®Œå…¨å…è´¹**ï¼šä¸éœ€è¦è´­ä¹° `docxtemplater-html-module`
2. **ç¨³å®šå¯é **ï¼šä¸ä¼šå‡ºç° split/duplicate å ä½ç¬¦é—®é¢˜
3. **ä¸ä¼š undefined**ï¼šæ‰€æœ‰å­—æ®µéƒ½æœ‰é»˜è®¤å€¼æˆ–å›é€€
4. **æ˜“äºè°ƒè¯•**ï¼šMarkdown æ˜¯çº¯æ–‡æœ¬ï¼Œå®¹æ˜“æŸ¥çœ‹å’Œä¿®æ”¹
5. **æ ¼å¼ä¿ç•™**ï¼šæ–¹æ¡ˆ A å¯ä»¥ä¿ç•™ HTML æ ¼å¼ï¼ˆç²—ä½“ã€åˆ—è¡¨ã€è¡¨æ ¼ç­‰ï¼‰
6. **è‡ªåŠ¨å›é€€**ï¼šå¦‚æœæ–¹æ¡ˆ A å¤±è´¥ï¼Œè‡ªåŠ¨ä½¿ç”¨æ–¹æ¡ˆ B

## ğŸ“ æ¨¡æ¿è¦æ±‚

### report-template-md.docx å¿…é¡»åŒ…å«ï¼š

1. **å°é¢éƒ¨åˆ†**ï¼ˆ6ä¸ªå ä½ç¬¦ï¼‰ï¼š
   - `{{INSPECTION_ID}}`
   - `{{ASSESSMENT_DATE}}`
   - `{{PREPARED_FOR}}`
   - `{{PREPARED_BY}}`
   - `{{PROPERTY_ADDRESS}}`
   - `{{PROPERTY_TYPE}}`

2. **æ­£æ–‡éƒ¨åˆ†**ï¼ˆå¿…éœ€ï¼‰ï¼š
   - `{{REPORT_BODY_HTML}}` - è¿™æ˜¯æ•´ä¸ªæŠ¥å‘Šæ­£æ–‡çš„ HTML å†…å®¹

## ğŸ§ª æµ‹è¯•æ–¹æ³•

### æœ¬åœ°æµ‹è¯•ï¼š
```bash
# å¯åŠ¨ Netlify Dev
npm run netlify:dev

# æµ‹è¯•ç”ŸæˆæŠ¥å‘Š
curl -X GET "http://localhost:8888/api/generateWordReport?inspection_id=EH-2026-01-004"
```

### æŸ¥çœ‹è°ƒè¯•æ—¥å¿—ï¼š
åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼Œæ§åˆ¶å°ä¼šè¾“å‡ºï¼š
- Findings counts
- Markdown é¢„è§ˆï¼ˆå‰ 1200 å­—ç¬¦ï¼‰
- HTML é¢„è§ˆï¼ˆå‰ 1200 å­—ç¬¦ï¼‰

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ¨¡æ¿æ–‡ä»¶**ï¼šç¡®ä¿ `report-template-md.docx` å·²åˆ›å»ºå¹¶åŒ…å«æ‰€æœ‰å¿…éœ€çš„å ä½ç¬¦
2. **æ„å»ºæµç¨‹**ï¼š`report-template-md.docx` ä¼šåœ¨æ„å»ºæ—¶è‡ªåŠ¨å¤åˆ¶åˆ° `netlify/functions/`
3. **å…¼å®¹æ€§**ï¼š`html-docx-js-typescript` ä½¿ç”¨ altChunkï¼ŒæŸäº› Word ç‰ˆæœ¬å¯èƒ½ä¸æ”¯æŒ
4. **å›é€€æ–¹æ¡ˆ**ï¼šå¦‚æœæ–¹æ¡ˆ A å¤±è´¥ï¼Œä¼šè‡ªåŠ¨ä½¿ç”¨æ–¹æ¡ˆ Bï¼ˆçº¯æ–‡æœ¬ï¼‰

## ğŸš€ ä¸‹ä¸€æ­¥

1. æµ‹è¯•ç”ŸæˆæŠ¥å‘Šï¼Œæ£€æŸ¥æ ¼å¼æ˜¯å¦æ­£ç¡®
2. æ ¹æ®å®é™…è¾“å‡ºè°ƒæ•´ Markdown æ ¼å¼
3. ä¼˜åŒ– HTML æ ·å¼ï¼ˆå¦‚æœéœ€è¦ï¼‰
4. æµ‹è¯•ä¸åŒçš„ findings ç»„åˆ

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `CURSOR_PROMPTS_STEP_BY_STEP.md` - å®Œæ•´å®æ–½æ­¥éª¤
- `å…è´¹æ›¿ä»£æ–¹æ¡ˆè¯´æ˜.md` - å…è´¹æ–¹æ¡ˆè¯¦ç»†è¯´æ˜
- `ä¾èµ–å®‰è£…è¯´æ˜.md` - ä¾èµ–å®‰è£…è¯´æ˜
