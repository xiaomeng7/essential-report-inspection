# 依赖安装说明

## ✅ 已安装的依赖

- ✅ `docxtemplater` (^3.67.6) - 已安装
- ✅ `pizzip` (^3.2.0) - 已安装  
- ✅ `markdown-it` (^14.1.0) - 已安装

## ⚠️ 付费模块

- ❌ `docxtemplater-html-module` - **付费模块**，需要购买
  - 购买地址：https://docxtemplater.com/shop/modules/?preselect=html
  - 价格：需要查看官网

## 🔄 替代方案

如果不想购买 `docxtemplater-html-module`，可以使用以下免费替代方案：

### 方案 A：使用 html-docx-js-typescript（推荐）

```bash
npm install html-docx-js-typescript
```

**优点：**
- 免费开源（MIT 许可证）
- 支持 TypeScript
- 可以将 HTML 转换为完整的 DOCX 文件
- 支持图片（base64）

**缺点：**
- 需要将 HTML 转换为独立的 DOCX，然后合并到模板
- 不支持在 docxtemplater 模板中直接插入 HTML

**使用示例：**
```typescript
import { asBlob } from 'html-docx-js-typescript';

const htmlContent = '<h1>Hello</h1><p>World</p>';
const docxBlob = await asBlob(htmlContent);
```

### 方案 B：将 HTML 转换为纯文本

使用 docxtemplater 的基础功能，将 HTML 转换为纯文本后插入：

```typescript
import { markdownToHtml } from './lib/markdownToHtml';

// 将 Markdown 转为 HTML
const html = markdownToHtml(markdown);

// 将 HTML 转为纯文本（去除标签）
const text = html.replace(/<[^>]*>/g, '').replace(/\n\s*\n/g, '\n\n');

// 使用 docxtemplater 插入纯文本
data.REPORT_BODY_TEXT = text;
```

**优点：**
- 完全免费
- 简单直接

**缺点：**
- 丢失所有格式（粗体、列表、表格等）
- 只适合简单文本

### 方案 C：使用 pandoc（需要服务器支持）

如果服务器支持命令行工具，可以使用 pandoc：

```bash
# 安装 pandoc
brew install pandoc  # macOS
sudo apt-get install pandoc  # Linux
```

```typescript
import { execSync } from 'child_process';
import fs from 'fs';

// 将 HTML 写入临时文件
fs.writeFileSync('/tmp/report.html', html);

// 使用 pandoc 转换为 docx
execSync('pandoc /tmp/report.html -o /tmp/report.docx');

// 读取生成的 docx
const docxBuffer = fs.readFileSync('/tmp/report.docx');
```

**优点：**
- 转换质量高
- 支持复杂格式

**缺点：**
- 需要服务器安装 pandoc
- Netlify Functions 可能不支持命令行工具

## 📝 推荐方案

**如果预算允许：**
- 购买 `docxtemplater-html-module`，这是最直接的方案

**如果使用免费方案：**
- 推荐使用 `html-docx-js-typescript`，然后：
  1. 生成完整的报告 DOCX（包含封面和正文）
  2. 或者将 HTML 转换为 DOCX 片段，然后使用 `docx-merger` 合并

## 🔧 下一步

根据选择的方案，更新 `CURSOR_PROMPTS_STEP_BY_STEP.md` 中的 Step 4 实现。
