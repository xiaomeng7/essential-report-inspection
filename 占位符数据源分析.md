# Word æ¨¡æ¿å ä½ç¬¦æ•°æ®æºåˆ†æ

## ğŸ“‹ ä¸€ã€å ä½ç¬¦æ•°æ®æ¥æºåˆ†ç±»

### 1.1 ä» `inspection.raw` ç›´æ¥æå–çš„å ä½ç¬¦

è¿™äº›å ä½ç¬¦çš„å€¼ç›´æ¥ä»æŠ€å¸ˆå¡«å†™çš„è¡¨å•æ•°æ®ä¸­æå–ï¼š

| å ä½ç¬¦ | æ•°æ®æ¥æºè·¯å¾„ | åå¤‡å€¼ | ä»£ç ä½ç½® |
|--------|------------|--------|---------|
| `INSPECTION_ID` | `inspection.inspection_id` | `""` | line 551 |
| `ASSESSMENT_DATE` | `inspection.raw.created_at` | å½“å‰æ—¥æœŸ | line 479-482 |
| `PREPARED_FOR` | `inspection.raw.client.name` æˆ– `client.client_type` | `""` | line 475 |
| `PREPARED_BY` | `inspection.raw.signoff.technician_name` | `"Better Home Technology Pty Ltd"` | line 476 |
| `PROPERTY_ADDRESS` | `inspection.raw.job.address` | `""` | line 473 |
| `PROPERTY_TYPE` | `inspection.raw.job.property_type` | `""` | line 474 |

### 1.2 ä» `findings` + `responses.yml` ç”Ÿæˆçš„å ä½ç¬¦

è¿™äº›å ä½ç¬¦çš„å€¼æ¥è‡ªæ£€æŸ¥ç»“æœï¼ˆfindingsï¼‰ï¼Œå¹¶é€šè¿‡ `responses.yml` è·å–æ ‡å‡†åŒ–æ–‡æœ¬ï¼š

| å ä½ç¬¦ | æ•°æ®æ¥æº | é€‰æ‹©é€»è¾‘ | ä»£ç ä½ç½® |
|--------|---------|---------|---------|
| `IMMEDIATE_FINDINGS` | `inspection.findings` (priority="IMMEDIATE") | é€šè¿‡ `responses.yml.findings[FINDING_CODE].title` è·å– | line 449-452 |
| `RECOMMENDED_FINDINGS` | `inspection.findings` (priority="RECOMMENDED_0_3_MONTHS") | é€šè¿‡ `responses.yml.findings[FINDING_CODE].title` è·å– | line 454-457 |
| `PLAN_FINDINGS` | `inspection.findings` (priority="PLAN_MONITOR") | é€šè¿‡ `responses.yml.findings[FINDING_CODE].title` è·å– | line 459-462 |
| `LIMITATIONS` | `inspection.limitations` æ•°ç»„ | ç›´æ¥ä½¿ç”¨æ•°ç»„å†…å®¹ | line 464-467 |

**å½“å‰é€‰æ‹©é€»è¾‘ï¼ˆ`buildReportData` å‡½æ•°ï¼Œline 325-344ï¼‰ï¼š**
```typescript
inspection.findings.forEach((finding) => {
  const findingCode = finding.id;  // ä¾‹å¦‚: "MEN_NOT_VERIFIED"
  const findingResponse = findingsMap[findingCode];  // ä» responses.yml æŸ¥æ‰¾
  
  // âš ï¸ åªä½¿ç”¨äº† title å­—æ®µï¼
  let findingText: string;
  if (findingResponse && findingResponse.title) {
    findingText = findingResponse.title;
  } else {
    findingText = finding.title || findingCode.replace(/_/g, " ");
  }
  
  // æ ¹æ® priority åˆ†ç»„
  if (finding.priority === "IMMEDIATE") {
    immediate.push(findingText);
  } else if (finding.priority === "RECOMMENDED_0_3_MONTHS") {
    recommended.push(findingText);
  } else if (finding.priority === "PLAN_MONITOR") {
    plan.push(findingText);
  }
});
```

### 1.3 ä»è®¡ç®—é€»è¾‘ç”Ÿæˆçš„å ä½ç¬¦

è¿™äº›å ä½ç¬¦çš„å€¼é€šè¿‡è®¡ç®—æˆ–ç¡¬ç¼–ç ç”Ÿæˆï¼š

| å ä½ç¬¦ | ç”Ÿæˆé€»è¾‘ | ä»£ç ä½ç½® |
|--------|---------|---------|
| `REPORT_VERSION` | ç¡¬ç¼–ç  `"1.0"` | line 561 |
| `OVERALL_STATUS` | æ ¹æ® findings æ•°é‡è®¡ç®— | line 485-494 |
| `EXECUTIVE_SUMMARY` | æ ¹æ® findings æ•°é‡ç”Ÿæˆæ‘˜è¦ | line 497-509 |
| `RISK_RATING` | æ ¹æ® findings æ•°é‡è®¡ç®—ï¼ˆHIGH/MODERATE/LOWï¼‰ | line 512-519 |
| `RISK_RATING_FACTORS` | æ ¹æ® findings æ•°é‡ç”Ÿæˆé£é™©å› ç´ æ–‡æœ¬ | line 521-531 |
| `URGENT_FINDINGS` | ç­‰åŒäº `IMMEDIATE_FINDINGS` | line 534 |
| `TEST_SUMMARY` | ç¡¬ç¼–ç æ–‡æœ¬ | line 537 |
| `TECHNICAL_NOTES` | ä» limitations + ç¡¬ç¼–ç æ–‡æœ¬ç»„åˆ | line 540-545 |

## ğŸ” äºŒã€ç¼ºå¤±æ•°æ®çš„å ä½ç¬¦

### 2.1 å½“å‰ä»£ç ä¸­å·²å®šä¹‰çš„å ä½ç¬¦ï¼ˆ18ä¸ªï¼‰

âœ… è¿™äº›å ä½ç¬¦éƒ½æœ‰æ•°æ®æºï¼š
- `INSPECTION_ID`
- `ASSESSMENT_DATE`
- `PREPARED_FOR`
- `PREPARED_BY`
- `PROPERTY_ADDRESS`
- `PROPERTY_TYPE`
- `IMMEDIATE_FINDINGS`
- `RECOMMENDED_FINDINGS`
- `PLAN_FINDINGS`
- `LIMITATIONS`
- `REPORT_VERSION`
- `OVERALL_STATUS`
- `EXECUTIVE_SUMMARY`
- `RISK_RATING`
- `RISK_RATING_FACTORS`
- `URGENT_FINDINGS`
- `TEST_SUMMARY`
- `TECHNICAL_NOTES`

### 2.2 å¯èƒ½ç¼ºå¤±æ•°æ®çš„å ä½ç¬¦

å¦‚æœ Word æ¨¡æ¿ä¸­ä½¿ç”¨äº†ä»¥ä¸‹å ä½ç¬¦ï¼Œå®ƒä»¬ä¼šæ˜¾ç¤ºä¸º `undefined` æˆ–ç©ºå­—ç¬¦ä¸²ï¼š

| å ä½ç¬¦ | è¯´æ˜ | æ˜¯å¦éœ€è¦æ·»åŠ  |
|--------|------|-------------|
| `OVERALL_STATUS_BADGE` | HTML æ¨¡æ¿ä¸­æœ‰ï¼ŒWord æ¨¡æ¿å¯èƒ½ä¹Ÿéœ€è¦ | âš ï¸ å¯èƒ½éœ€è¦ |
| `EXECUTIVE_SUMMARY_PARAGRAPH` | HTML æ¨¡æ¿ä¸­æœ‰ï¼ŒWord æ¨¡æ¿å¯èƒ½ä¹Ÿéœ€è¦ | âš ï¸ å¯èƒ½éœ€è¦ |
| `RISK_RATING_BADGE` | HTML æ¨¡æ¿ä¸­æœ‰ï¼ŒWord æ¨¡æ¿å¯èƒ½ä¹Ÿéœ€è¦ | âš ï¸ å¯èƒ½éœ€è¦ |
| `PRIORITY_IMMEDIATE_DESC` | ä¼˜å…ˆçº§æè¿° | âš ï¸ å¯èƒ½éœ€è¦ |
| `PRIORITY_IMMEDIATE_INTERP` | ä¼˜å…ˆçº§è§£é‡Š | âš ï¸ å¯èƒ½éœ€è¦ |
| `PRIORITY_RECOMMENDED_DESC` | ä¼˜å…ˆçº§æè¿° | âš ï¸ å¯èƒ½éœ€è¦ |
| `PRIORITY_RECOMMENDED_INTERP` | ä¼˜å…ˆçº§è§£é‡Š | âš ï¸ å¯èƒ½éœ€è¦ |
| `PRIORITY_PLAN_DESC` | ä¼˜å…ˆçº§æè¿° | âš ï¸ å¯èƒ½éœ€è¦ |
| `PRIORITY_PLAN_INTERP` | ä¼˜å…ˆçº§è§£é‡Š | âš ï¸ å¯èƒ½éœ€è¦ |
| `LIMITATIONS_SECTION` | HTML æ¨¡æ¿ä¸­æœ‰ | âš ï¸ å¯èƒ½éœ€è¦ |
| `PLAN_MONITOR_FINDINGS` | HTML æ¨¡æ¿ä¸­æœ‰ï¼ŒWord ä½¿ç”¨ `PLAN_FINDINGS` | âœ… å·²æ˜ å°„ |
| `GENERAL_OBSERVATIONS_NOTES` | HTML æ¨¡æ¿ä¸­æœ‰ | âš ï¸ å¯èƒ½éœ€è¦ |
| `CAPITAL_PLANNING_TABLE` | HTML æ¨¡æ¿ä¸­æœ‰ | âš ï¸ å¯èƒ½éœ€è¦ |
| `TEST_RESULTS_SUMMARY` | HTML æ¨¡æ¿ä¸­æœ‰ï¼ŒWord ä½¿ç”¨ `TEST_SUMMARY` | âœ… å·²æ˜ å°„ |

## ğŸ“ ä¸‰ã€Responses.yml é€‰æ‹©é€»è¾‘è¯¦è§£

### 3.1 å½“å‰é€»è¾‘

**æ–‡ä»¶ä½ç½®ï¼š** `netlify/functions/generateWordReport.ts` çš„ `buildReportData` å‡½æ•°ï¼ˆline 315-353ï¼‰

**æµç¨‹ï¼š**
1. åŠ è½½ `responses.yml` æ–‡ä»¶ï¼ˆä¼˜å…ˆä» Blob Storeï¼Œåå¤‡æ–‡ä»¶ç³»ç»Ÿï¼‰
2. è·å– `responses.findings` æ˜ å°„è¡¨
3. éå† `inspection.findings` ä¸­çš„æ¯ä¸ª findingï¼š
   - ä½¿ç”¨ `finding.id`ï¼ˆfinding codeï¼Œå¦‚ `MEN_NOT_VERIFIED`ï¼‰ä½œä¸º key
   - åœ¨ `responses.findings` ä¸­æŸ¥æ‰¾å¯¹åº”çš„å“åº”å¯¹è±¡
   - **åªæå– `title` å­—æ®µ**
   - å¦‚æœæ‰¾ä¸åˆ°ï¼Œä½¿ç”¨ `finding.title` æˆ– `findingCode.replace(/_/g, " ")` ä½œä¸ºåå¤‡
4. æ ¹æ® `finding.priority` åˆ†ç»„åˆ° `immediate`ã€`recommended`ã€`plan` æ•°ç»„

### 3.2 Responses.yml ç»“æ„

```yaml
meta:
  version: v1.0
  updated: '2026-01-28'
  language: en-AU

defaults:
  no_immediate: "No immediate safety risks..."
  no_recommended: "No items requiring short-term..."
  no_plan: "No additional items..."
  limitations: "This assessment is non-invasive..."

findings:
  MEN_NOT_VERIFIED:
    title: "MEN Link Not Verified"
    why_it_matters: "The MEN link is critical for..."
    recommended_action: "Have a licensed electrician..."
    planning_guidance: "If no immediate hazard..."
    disclaimer_line: ""
  
  NO_RCD_PROTECTION:
    title: "No RCD Protection"
    why_it_matters: "RCD protection is required..."
    recommended_action: "Install RCD protection..."
    planning_guidance: "This should be prioritized..."
    disclaimer_line: ""
```

### 3.3 å½“å‰é—®é¢˜

âŒ **åªä½¿ç”¨äº† `title` å­—æ®µ**ï¼Œå…¶ä»–å­—æ®µï¼ˆ`why_it_matters`ã€`recommended_action`ã€`planning_guidance`ï¼‰æ²¡æœ‰è¢«ä½¿ç”¨ã€‚

å¦‚æœ Word æ¨¡æ¿éœ€è¦æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼ˆå¦‚æ¯ä¸ª finding çš„å®Œæ•´æè¿°ï¼‰ï¼Œå½“å‰ä»£ç æ— æ³•æä¾›ã€‚

## ğŸ”§ å››ã€å¦‚ä½•ä¿®æ”¹ Responses é€‰æ‹©é€»è¾‘

### æ–¹æ¡ˆ 1ï¼šæ‰©å±• `buildReportData` è¿”å›å®Œæ•´å“åº”å¯¹è±¡

**ä¿®æ”¹ä½ç½®ï¼š** `netlify/functions/generateWordReport.ts`

**ä¿®æ”¹å†…å®¹ï¼š**
```typescript
// ä¿®æ”¹ ReportData ç±»å‹å®šä¹‰
type ReportData = {
  inspection_id: string;
  immediate: Array<{
    code: string;
    title: string;
    why_it_matters?: string;
    recommended_action?: string;
    planning_guidance?: string;
  }>;
  recommended: Array<{...}>;  // åŒä¸Š
  plan: Array<{...}>;  // åŒä¸Š
  limitations: string[];
};

// ä¿®æ”¹ buildReportData å‡½æ•°
export async function buildReportData(inspection: StoredInspection, event?: HandlerEvent): Promise<ReportData> {
  const responses = await loadResponses(event);
  const findingsMap = responses.findings || {};
  
  const immediate: ReportData['immediate'] = [];
  const recommended: ReportData['recommended'] = [];
  const plan: ReportData['plan'] = [];
  
  inspection.findings.forEach((finding) => {
    const findingCode = finding.id;
    const findingResponse = findingsMap[findingCode];
    
    // âœ… è¿”å›å®Œæ•´çš„å“åº”å¯¹è±¡
    const findingData = {
      code: findingCode,
      title: findingResponse?.title || finding.title || findingCode.replace(/_/g, " "),
      why_it_matters: findingResponse?.why_it_matters || "",
      recommended_action: findingResponse?.recommended_action || "",
      planning_guidance: findingResponse?.planning_guidance || "",
    };
    
    if (finding.priority === "IMMEDIATE") {
      immediate.push(findingData);
    } else if (finding.priority === "RECOMMENDED_0_3_MONTHS") {
      recommended.push(findingData);
    } else if (finding.priority === "PLAN_MONITOR") {
      plan.push(findingData);
    }
  });
  
  return {
    inspection_id: inspection.inspection_id,
    immediate,
    recommended,
    plan,
    limitations: inspection.limitations || [],
  };
}
```

### æ–¹æ¡ˆ 2ï¼šåˆ›å»ºæ ¼å¼åŒ–å‡½æ•°ï¼Œä½¿ç”¨å®Œæ•´å“åº”ä¿¡æ¯

**ä¿®æ”¹ä½ç½®ï¼š** `netlify/functions/generateWordReport.ts`

**ä¿®æ”¹å†…å®¹ï¼š**
```typescript
// åˆ›å»ºæ ¼å¼åŒ–å‡½æ•°
function formatFindingWithResponse(
  finding: Finding,
  response: FindingResponse | undefined,
  format: 'title' | 'full' | 'detailed' = 'title'
): string {
  const title = response?.title || finding.title || finding.id.replace(/_/g, " ");
  
  if (format === 'title') {
    return title;
  }
  
  if (format === 'full') {
    return `${title}\n\nWhy it matters: ${response?.why_it_matters || 'N/A'}\n\nRecommended action: ${response?.recommended_action || 'N/A'}`;
  }
  
  if (format === 'detailed') {
    return `${title}\n\nWhy it matters: ${response?.why_it_matters || 'N/A'}\n\nRecommended action: ${response?.recommended_action || 'N/A'}\n\nPlanning guidance: ${response?.planning_guidance || 'N/A'}`;
  }
  
  return title;
}

// ä¿®æ”¹ formatFindingsText å‡½æ•°
function formatFindingsText(
  items: Array<{code: string; title: string; why_it_matters?: string; recommended_action?: string}>,
  defaultText: string,
  format: 'title' | 'full' | 'detailed' = 'title'
): string {
  if (items.length === 0) {
    return defaultText;
  }
  
  if (format === 'title') {
    return items.map(item => `â€¢ ${item.title}`).join("\n");
  }
  
  if (format === 'full') {
    return items.map(item => 
      `â€¢ ${item.title}\n  Why it matters: ${item.why_it_matters || 'N/A'}\n  Recommended action: ${item.recommended_action || 'N/A'}`
    ).join("\n\n");
  }
  
  // detailed format...
  return items.map(item => `â€¢ ${item.title}`).join("\n");
}
```

### æ–¹æ¡ˆ 3ï¼šåœ¨æ¨¡æ¿æ•°æ®ä¸­æ·»åŠ è¯¦ç»†å ä½ç¬¦

**ä¿®æ”¹ä½ç½®ï¼š** `netlify/functions/generateWordReport.ts` çš„ handler å‡½æ•°

**ä¿®æ”¹å†…å®¹ï¼š**
```typescript
// åœ¨ templateData ä¸­æ·»åŠ è¯¦ç»†å ä½ç¬¦
const templateData: Record<string, string> = {
  // ... ç°æœ‰å ä½ç¬¦ ...
  
  // æ·»åŠ è¯¦ç»† findings æ–‡æœ¬ï¼ˆåŒ…å« why_it_matters å’Œ recommended_actionï¼‰
  IMMEDIATE_FINDINGS_DETAILED: formatFindingsText(
    reportData.immediate.map(f => ({
      code: f.code,
      title: f.title,
      why_it_matters: f.why_it_matters,
      recommended_action: f.recommended_action
    })),
    defaults.no_immediate || "",
    'full'  // ä½¿ç”¨å®Œæ•´æ ¼å¼
  ),
  
  RECOMMENDED_FINDINGS_DETAILED: formatFindingsText(
    reportData.recommended.map(f => ({...})),
    defaults.no_recommended || "",
    'full'
  ),
  
  PLAN_FINDINGS_DETAILED: formatFindingsText(
    reportData.plan.map(f => ({...})),
    defaults.no_plan || "",
    'full'
  ),
};
```

## ğŸ“‹ äº”ã€å»ºè®®çš„ä¿®æ”¹æ­¥éª¤

### æ­¥éª¤ 1ï¼šæ£€æŸ¥ Word æ¨¡æ¿ä¸­çš„å®é™…å ä½ç¬¦

è¿è¡Œä»¥ä¸‹å‘½ä»¤æ£€æŸ¥ Word æ¨¡æ¿ä¸­å®é™…ä½¿ç”¨çš„å ä½ç¬¦ï¼š
```bash
# ä½¿ç”¨ fix-placeholders.ts è„šæœ¬æå–å ä½ç¬¦
node scripts/fix-placeholders.ts --extract-placeholders report-template.docx
```

### æ­¥éª¤ 2ï¼šå¯¹æ¯”ç¼ºå¤±çš„å ä½ç¬¦

å°† Word æ¨¡æ¿ä¸­çš„å ä½ç¬¦ä¸ `templateData` ä¸­çš„å ä½ç¬¦å¯¹æ¯”ï¼Œæ‰¾å‡ºç¼ºå¤±çš„ã€‚

### æ­¥éª¤ 3ï¼šé€‰æ‹©ä¿®æ”¹æ–¹æ¡ˆ

æ ¹æ® Word æ¨¡æ¿çš„éœ€æ±‚é€‰æ‹©ï¼š
- **å¦‚æœåªéœ€è¦æ ‡é¢˜**ï¼šä¿æŒå½“å‰é€»è¾‘ï¼Œä½†ç¡®ä¿æ‰€æœ‰å ä½ç¬¦éƒ½æœ‰æ•°æ®æº
- **å¦‚æœéœ€è¦è¯¦ç»†ä¿¡æ¯**ï¼šä½¿ç”¨æ–¹æ¡ˆ 1 æˆ–æ–¹æ¡ˆ 2ï¼Œæ‰©å±• `buildReportData` å‡½æ•°
- **å¦‚æœéœ€è¦çµæ´»çš„æ ¼å¼**ï¼šä½¿ç”¨æ–¹æ¡ˆ 3ï¼Œæ·»åŠ å¤šç§æ ¼å¼çš„å ä½ç¬¦

### æ­¥éª¤ 4ï¼šä¿®æ”¹ä»£ç 

æŒ‰ç…§é€‰æ‹©çš„æ–¹æ¡ˆä¿®æ”¹ä»£ç ï¼Œç¡®ä¿ï¼š
1. æ‰€æœ‰ Word æ¨¡æ¿ä¸­çš„å ä½ç¬¦éƒ½æœ‰å¯¹åº”çš„æ•°æ®æº
2. æ‰€æœ‰å€¼éƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼ˆé¿å… undefinedï¼‰
3. æä¾›åˆç†çš„åå¤‡å€¼

### æ­¥éª¤ 5ï¼šæµ‹è¯•

1. ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
2. æ£€æŸ¥æ‰€æœ‰å ä½ç¬¦æ˜¯å¦æ­£ç¡®å¡«å……
3. ç¡®è®¤æ²¡æœ‰ "undefined" å‡ºç°

## ğŸ“ å…­ã€æ€»ç»“

### å½“å‰çŠ¶æ€
- âœ… 18 ä¸ªåŸºæœ¬å ä½ç¬¦éƒ½æœ‰æ•°æ®æº
- âŒ åªä½¿ç”¨äº† `responses.yml` ä¸­çš„ `title` å­—æ®µ
- âš ï¸ å¦‚æœ Word æ¨¡æ¿éœ€è¦æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼Œéœ€è¦ä¿®æ”¹ä»£ç 

### æ¨èæ–¹æ¡ˆ
**æ–¹æ¡ˆ 2ï¼ˆåˆ›å»ºæ ¼å¼åŒ–å‡½æ•°ï¼‰** æœ€çµæ´»ï¼Œå¯ä»¥ï¼š
- ä¿æŒå‘åå…¼å®¹ï¼ˆtitle æ ¼å¼ï¼‰
- æ”¯æŒè¯¦ç»†æ ¼å¼ï¼ˆfull/detailedï¼‰
- æ˜“äºæ‰©å±•å’Œç»´æŠ¤

### ä¸‹ä¸€æ­¥
1. æ£€æŸ¥ Word æ¨¡æ¿ä¸­å®é™…ä½¿ç”¨çš„å ä½ç¬¦
2. æ ¹æ®éœ€æ±‚é€‰æ‹©åˆé€‚çš„ä¿®æ”¹æ–¹æ¡ˆ
3. å®æ–½ä¿®æ”¹å¹¶æµ‹è¯•
