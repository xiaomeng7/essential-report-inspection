# 邮件通知配置详细步骤

本指南将一步一步教你如何配置邮件发送功能，让系统在提交检查后自动发送邮件到 **info@bhtechnology.com.au**。

---

## 第一步：安装 Resend 依赖包

### 1.1 打开终端

- 在 VS Code / Cursor 中，按 `Ctrl + ~`（Windows/Linux）或 `Cmd + ~`（Mac）打开终端
- 或者点击顶部菜单：**Terminal** → **New Terminal**

### 1.2 进入项目目录

确保你在项目根目录（`/Users/mengzhang/Downloads/essential_report_specs`），如果不在，运行：

```bash
cd /Users/mengzhang/Downloads/essential_report_specs
```

### 1.3 安装依赖

运行以下命令安装 Resend 包：

```bash
npm install
```

这会安装 `package.json` 中列出的所有依赖，包括新添加的 `resend`。

**预期输出**：看到类似 "added 1 package" 的提示，表示安装成功。

---

## 第二步：注册 Resend 账号

### 2.1 访问 Resend 官网

1. 打开浏览器，访问：**https://resend.com**
2. 点击右上角的 **Sign Up**（注册）或 **Log In**（登录）

### 2.2 注册账号

- 如果还没有账号，使用邮箱注册（建议使用 `info@bhtechnology.com.au` 或你的常用邮箱）
- 完成邮箱验证

### 2.3 登录后进入 Dashboard

登录成功后，你会看到 Resend 的控制台（Dashboard）。

---

## 第三步：创建 API Key

### 3.1 进入 API Keys 页面

1. 在左侧菜单找到 **API Keys**，点击进入
2. 或直接访问：**https://resend.com/api-keys**

### 3.2 创建新的 API Key

1. 点击 **Create API Key** 按钮
2. 输入一个名称，例如：`Netlify Inspection App`
3. 选择权限：选择 **Full Access**（完整权限）
4. 点击 **Add** 或 **Create**

### 3.3 复制 API Key

⚠️ **重要**：API Key 只会显示一次，请立即复制并保存！

- 你会看到一个以 `re_` 开头的长字符串，例如：`re_1234567890abcdef...`
- **立即复制这个 Key**（点击复制按钮或手动选择复制）
- 建议保存到安全的地方（密码管理器或临时文档）

---

## 第三步：验证域名（可选但推荐）

### 3.1 为什么需要验证域名？

- Resend 要求发件地址必须使用**已验证的域名**
- 如果不验证，只能使用 `onboarding@resend.dev`，且只能发给你自己的邮箱（用于测试）
- 验证后可以使用 `reports@bhtechnology.com.au` 这样的专业地址

### 3.2 添加域名

1. 在左侧菜单点击 **Domains**
2. 点击 **Add Domain** 按钮
3. 输入域名：`bhtechnology.com.au`（或你的实际域名）
4. 点击 **Add**

### 3.3 配置 DNS 记录

Resend 会显示需要添加的 DNS 记录，例如：

```
Type: TXT
Name: @
Value: resend-domain-verification=xxxxx...

Type: MX
Name: @
Value: feedback-smtp.resend.com
Priority: 10
```

**操作步骤**：

1. 登录你的域名管理后台（例如 GoDaddy、Namecheap、Cloudflare 等）
2. 找到 DNS 设置 / DNS 管理
3. 添加 Resend 提供的 DNS 记录
4. 保存后等待几分钟到几小时（DNS 传播需要时间）

### 3.4 验证状态

- 回到 Resend 的 Domains 页面
- 等待状态变为 **Verified**（已验证）
- 如果显示 **Pending**，继续等待 DNS 传播

**注意**：如果暂时无法验证域名，可以先用 `onboarding@resend.dev` 测试，但只能发给你自己的邮箱。

---

## 第四步：在 Netlify 配置环境变量

### 4.1 登录 Netlify

1. 打开浏览器，访问：**https://app.netlify.com**
2. 登录你的 Netlify 账号

### 4.2 进入你的站点

1. 在 Dashboard 中找到你的站点（例如 `inspeti`）
2. 点击站点名称进入站点详情页

### 4.3 打开环境变量设置

1. 点击顶部菜单：**Site configuration**（站点配置）
2. 在左侧菜单找到 **Environment variables**（环境变量）
3. 点击进入

### 4.4 添加 RESEND_API_KEY

1. 点击 **Add a variable**（添加变量）或 **Add environment variable**
2. 在 **Key** 输入框输入：`RESEND_API_KEY`
3. 在 **Value** 输入框粘贴你之前复制的 API Key（`re_xxxx...`）
4. 选择作用域：
   - **All scopes**（所有环境）或
   - **Production**（仅生产环境）
5. 点击 **Save** 或 **Add variable**

### 4.5 添加 RESEND_FROM（可选但推荐）

如果你已经验证了域名，添加发件人地址：

1. 再次点击 **Add a variable**
2. **Key**：`RESEND_FROM`
3. **Value**：`Electrical Inspection <reports@bhtechnology.com.au>`
   - 如果域名未验证，可以先用：`Electrical Inspection <onboarding@resend.dev>`
4. 选择作用域（同上）
5. 点击 **Save**

**最终效果**：你应该看到两个环境变量：
- `RESEND_API_KEY` = `re_xxxx...`
- `RESEND_FROM` = `Electrical Inspection <reports@bhtechnology.com.au>`

---

## 第五步：重新部署站点

### 5.1 触发部署

环境变量配置后，需要重新部署才能生效：

1. 在 Netlify 站点页面，点击顶部菜单：**Deploys**（部署）
2. 点击右上角的 **Trigger deploy**（触发部署）
3. 选择 **Deploy site**（部署站点）

### 5.2 等待部署完成

- 部署过程可能需要 1-3 分钟
- 等待状态变为 **Published**（已发布）

---

## 第六步：测试邮件发送

### 6.1 提交一条测试检查

1. 访问你的站点（例如：`https://inspeti.netlify.app`）
2. 填写并提交一条测试检查
3. 提交成功后，系统会尝试发送邮件

### 6.2 检查邮件

1. 登录 **info@bhtechnology.com.au** 邮箱
2. 查看收件箱（包括垃圾邮件文件夹）
3. 应该收到主题为 "New Inspection Report: [ID] - [地址]" 的邮件

### 6.3 查看日志（如果没收到邮件）

如果没收到邮件，检查 Netlify 日志：

1. 在 Netlify 站点页面，点击 **Functions**（函数）
2. 找到 **submitInspection**
3. 点击进入，查看 **Logs**（日志）
4. 查找：
   - ✅ **成功**：`Email sent via Resend: [邮件ID]`
   - ❌ **失败**：`Resend send error: [错误信息]`

**常见错误**：
- `Invalid API key`：API Key 错误，检查是否复制完整
- `Invalid from address`：发件地址未验证，检查域名验证状态
- `Rate limit exceeded`：发送频率过高，等待后重试

---

## 完成！

如果一切正常，你现在应该：

✅ 提交检查后自动发送邮件到 **info@bhtechnology.com.au**  
✅ 邮件包含检查详情、发现的问题、限制和报告链接  
✅ 在 Netlify 日志中可以看到发送成功的记录

---

## 需要帮助？

如果遇到问题：

1. **检查环境变量**：确认 `RESEND_API_KEY` 和 `RESEND_FROM` 都已正确设置
2. **查看 Netlify 日志**：在 Functions → submitInspection → Logs 中查看详细错误
3. **验证域名状态**：在 Resend Dashboard → Domains 确认域名已验证
4. **检查垃圾邮件**：邮件可能被标记为垃圾邮件

---

**下一步**：配置完成后，记得将代码推送到 GitHub，这样下次部署时会自动包含这些配置。
