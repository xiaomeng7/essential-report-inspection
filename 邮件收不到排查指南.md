# 邮件收不到排查指南

## 重要说明：发件人地址不需要注册

**`reports@bhtechnology.com.au` 是发件人地址（FROM），不需要实际注册这个邮箱。**

- ✅ **发件人地址**：`reports@bhtechnology.com.au` - 只需要域名在 Resend 验证通过即可
- ✅ **收件人地址**：`info@bhtechnology.com.au` - 这个邮箱**必须存在**，能正常接收邮件

---

## 排查步骤（按顺序检查）

### 1️⃣ 检查 Netlify 环境变量

#### 1.1 登录 Netlify

1. 访问：https://app.netlify.com
2. 进入你的站点

#### 1.2 检查环境变量

1. 点击 **Site configuration** → **Environment variables**
2. 确认以下两个变量**都已设置**：

| 变量名 | 值示例 | 检查要点 |
|--------|--------|----------|
| `RESEND_API_KEY` | `re_1234567890abcdef...` | ✅ 必须以 `re_` 开头<br>✅ 完整复制，没有多余空格<br>✅ 选择的作用域包含 **Production** |
| `RESEND_FROM` | `Electrical Inspection <reports@bhtechnology.com.au>` | ✅ 格式：`显示名称 <邮箱地址>`<br>✅ 邮箱地址必须是已验证的域名下的地址 |

**常见错误**：
- ❌ `RESEND_API_KEY` 没有设置 → 邮件不会发送（只会在日志中记录）
- ❌ `RESEND_API_KEY` 值错误或有多余空格 → Resend API 会返回错误
- ❌ `RESEND_FROM` 格式错误 → Resend 会拒绝发送

#### 1.3 如果修改了环境变量

**必须重新部署**才能生效：
1. 在 Netlify 点击 **Deploys** → **Trigger deploy** → **Deploy site**
2. 等待部署完成（状态变为 **Published**）

---

### 2️⃣ 检查 Netlify Functions 日志

这是**最关键的排查步骤**，日志会告诉你邮件是否发送成功，或失败原因。

#### 2.1 查看日志

1. 在 Netlify 站点页面，点击 **Functions**（函数）
2. 找到 **submitInspection**，点击进入
3. 点击 **Logs**（日志）标签

#### 2.2 查看最近一次提交的日志

提交一条测试检查后，在日志中查找：

**✅ 成功的情况**：
```
Email sent via Resend: eml_xxxxx...
```
或
```
Email sent via Resend: { id: 'eml_xxxxx...' }
```

**❌ 失败的情况**，会看到以下之一：

1. **API Key 未设置**：
   ```
   Email notification prepared (RESEND_API_KEY not set, skipping send)
   ```
   → **解决方法**：在 Netlify 环境变量中添加 `RESEND_API_KEY`

2. **API Key 无效**：
   ```
   Resend send error: { message: 'Invalid API key' }
   ```
   → **解决方法**：检查 API Key 是否正确复制，没有多余空格

3. **发件地址未验证**：
   ```
   Resend send error: { message: 'Invalid from address' }
   ```
   → **解决方法**：确认域名在 Resend 已验证，`RESEND_FROM` 使用的是已验证域名下的地址

4. **其他错误**：
   ```
   Resend send error: { message: '...' }
   ```
   → 查看具体错误信息，根据提示解决

---

### 3️⃣ 检查收件人邮箱

#### 3.1 确认邮箱存在

- **`info@bhtechnology.com.au` 这个邮箱必须存在且能正常接收邮件**
- 如果这个邮箱不存在，邮件会发送失败或退回

#### 3.2 检查垃圾邮件文件夹

- 邮件可能被标记为垃圾邮件
- 检查 **垃圾邮件** / **Spam** 文件夹
- 如果找到了，标记为"不是垃圾邮件"，以后就不会被过滤

#### 3.3 检查邮箱设置

- 确认邮箱没有设置过滤规则阻止来自 `reports@bhtechnology.com.au` 的邮件
- 确认邮箱空间未满

---

### 4️⃣ 检查 Resend Dashboard

#### 4.1 查看发送记录

1. 登录 [Resend](https://resend.com)
2. 进入 **Emails**（邮件）页面
3. 查看是否有发送记录

**如果有发送记录**：
- ✅ 说明邮件已从 Resend 发出
- 问题可能在收件人邮箱端（垃圾邮件、过滤规则等）

**如果没有发送记录**：
- ❌ 说明邮件没有成功发送
- 检查 Netlify 日志中的错误信息

#### 4.2 检查域名状态

1. 在 Resend 进入 **Domains**
2. 确认 `bhtechnology.com.au` 状态为 **Verified**（已验证）
3. 如果状态不是 Verified，DNS 记录可能还没生效，等待更长时间

---

### 5️⃣ 测试邮件发送

#### 5.1 在 Resend Dashboard 测试

1. 登录 Resend → **Emails** → **Send Email**
2. 填写：
   - **From**: `reports@bhtechnology.com.au`（或你验证的域名下的地址）
   - **To**: `info@bhtechnology.com.au`
   - **Subject**: `Test Email`
   - **Body**: `This is a test`
3. 点击 **Send**

**如果测试邮件能收到**：
- ✅ 说明 Resend 配置正确
- 问题可能在代码逻辑或 Netlify 环境变量

**如果测试邮件收不到**：
- ❌ 检查域名验证状态
- ❌ 检查 DNS 记录是否正确

---

## 常见问题快速诊断

| 症状 | 可能原因 | 解决方法 |
|------|----------|----------|
| 日志显示 "RESEND_API_KEY not set" | 环境变量未设置 | 在 Netlify 添加 `RESEND_API_KEY` 并重新部署 |
| 日志显示 "Invalid API key" | API Key 错误 | 检查 API Key 是否正确复制，没有多余空格 |
| 日志显示 "Invalid from address" | 发件地址未验证 | 确认域名在 Resend 已验证，使用已验证域名下的地址 |
| 日志显示 "Email sent via Resend" 但收不到 | 邮件被过滤或邮箱问题 | 检查垃圾邮件文件夹，确认收件邮箱存在 |
| Resend Dashboard 没有发送记录 | 邮件没有发送 | 检查 Netlify 日志中的错误信息 |
| 域名状态不是 Verified | DNS 记录未生效 | 等待更长时间（最多 48 小时），检查 DNS 记录是否正确 |

---

## 下一步

1. **先检查 Netlify 日志**（步骤 2）- 这是最直接的诊断方法
2. **确认环境变量已设置并重新部署**（步骤 1）
3. **检查垃圾邮件文件夹**（步骤 3）
4. **在 Resend Dashboard 测试发送**（步骤 5）

如果以上都检查过了还是收不到，请把 **Netlify Functions 日志** 中的错误信息发给我，我可以帮你进一步排查。
