# æŠ¥å‘Šåˆ¤æ–­é€»è¾‘è¯´æ˜

## ğŸ“‹ æ¦‚è¿°

æŠ¥å‘Šç”Ÿæˆåˆ†ä¸ºä¸‰ä¸ªä¸»è¦æ­¥éª¤ï¼š
1. **ä»æ£€æŸ¥æ•°æ®æå– Findings**ï¼ˆå‘ç°é—®é¢˜ï¼‰
2. **è®¡ç®—ä¼˜å…ˆçº§**ï¼ˆç¡®å®šç´§æ€¥ç¨‹åº¦ï¼‰
3. **ç”ŸæˆæŠ¥å‘Š**ï¼ˆæŒ‰ä¼˜å…ˆçº§åˆ†ç»„ï¼‰

---

## ç¬¬ä¸€æ­¥ï¼šä»æ£€æŸ¥æ•°æ®æå– Findings

ç³»ç»Ÿæ ¹æ®æ£€æŸ¥è¡¨å•çš„è¾“å…¥ï¼Œè‡ªåŠ¨è¯†åˆ«é—®é¢˜å¹¶ç”Ÿæˆ **Finding ID**ã€‚

### è§¦å‘æ¡ä»¶ç¤ºä¾‹

| Finding ID | è§¦å‘æ¡ä»¶ |
|------------|----------|
| `ASBESTOS_RISK` | `switchboard.asbestos_suspected === "yes"` |
| `THERMAL_STRESS_ACTIVE` | `switchboard.signs_of_overheating === "yes"` |
| `ARCING_EVIDENCE_PRESENT` | `switchboard.burn_marks_or_carbon === "yes"` |
| `MATERIAL_DEGRADATION` | `switchboard.water_ingress === "yes"` |
| `MEN_NOT_VERIFIED` | `earthing.men_link_confirmed === "no"` |
| `EARTH_DEGRADED` | `earthing.main_earth_conductor_intact === "no"` |
| `BOARD_AT_CAPACITY` | `switchboard.board_at_capacity === "yes"` |
| `NO_EXPANSION_MARGIN` | `switchboard.spare_ways_available === "no"` |
| `LABELING_POOR` | `switchboard.labelling_quality === "poor"` |
| `NON_STANDARD_WORK` | `switchboard.non_standard_or_diy_observed === "yes"` |
| `NO_RCD_PROTECTION` | `rcd_tests.performed === false` |
| `GPO_EARTH_FAULT` | `rcd_tests.performed === true` ä¸” `rcd_tests.summary.total_fail > 0` |
| `GPO_MECHANICAL_LOOSE` | `gpo_tests.any_warm_loose_damaged === true` |
| `FITTING_OVERHEAT` | `lighting.issues_observed === "heat_damage"` |
| `SWITCH_ARCING` | `lighting.issues_observed === "flicker"` |
| `BATTERY_THERMAL` | `assets.has_battery === true` ä¸” `assets.any_issues_observed === true` |
| `EV_UNSEGREGATED_LOAD` | `assets.has_ev_charger === true` ä¸” `assets.any_issues_observed === true` |
| `PV_ISOLATION_UNVERIFIED` | `assets.has_solar_pv === true` ä¸” `assets.any_issues_observed === true` |

**ä»£ç ä½ç½®**: `netlify/functions/lib/rules.ts` çš„ `factsToFindings()` å‡½æ•°

---

## ç¬¬äºŒæ­¥ï¼šè®¡ç®—ä¼˜å…ˆçº§ï¼ˆPriority Bucketï¼‰

æ¯ä¸ª Finding éƒ½æœ‰ä¸‰ä¸ªç»´åº¦ï¼š
- **Safety**ï¼ˆå®‰å…¨æ€§ï¼‰: `HIGH` / `MODERATE` / `LOW`
- **Urgency**ï¼ˆç´§æ€¥æ€§ï¼‰: `IMMEDIATE` / `SHORT_TERM` / `LONG_TERM`
- **Liability**ï¼ˆè´£ä»»é£é™©ï¼‰: `HIGH` / `MEDIUM` / `LOW`

ä¼˜å…ˆçº§è®¡ç®—éµå¾ªä»¥ä¸‹è§„åˆ™ï¼ˆæŒ‰é¡ºåºæ‰§è¡Œï¼‰ï¼š

### 1ï¸âƒ£ Hard Overridesï¼ˆç¡¬æ€§è¦†ç›–ï¼‰

**è§„åˆ™**: å¦‚æœ Finding ID åœ¨ `hard_overrides.findings` åˆ—è¡¨ä¸­ï¼Œ**ç›´æ¥è¿”å› `IMMEDIATE`**ï¼Œè·³è¿‡åç»­æ‰€æœ‰è®¡ç®—ã€‚

**å½“å‰ç¡¬æ€§è¦†ç›–åˆ—è¡¨**:
- MEN_NOT_VERIFIED
- SUPPLY_NO_MAIN_ISOLATION
- THERMAL_STRESS_ACTIVE
- MATERIAL_DEGRADATION
- ARCING_EVIDENCE_PRESENT
- ASBESTOS_RISK
- NO_RCD_PROTECTION
- GPO_EARTH_FAULT
- EXPOSED_CONDUCTOR
- SMOKE_ALARM_FAILURE
- BATTERY_THERMAL
- EV_UNSEGREGATED_LOAD

### 2ï¸âƒ£ Base Priority Matrixï¼ˆåŸºç¡€ä¼˜å…ˆçº§çŸ©é˜µï¼‰

æ ¹æ® Safety å’Œ Urgency ç»„åˆï¼ŒæŸ¥æ‰¾åŒ¹é…çš„è§„åˆ™ï¼š

| Safety | Urgency | ä¼˜å…ˆçº§ |
|--------|---------|--------|
| `HIGH` | *ä»»æ„* | `IMMEDIATE` |
| `MODERATE` | `IMMEDIATE` | `IMMEDIATE` |
| `MODERATE` | `SHORT_TERM` | `RECOMMENDED_0_3_MONTHS` |
| `MODERATE` | `LONG_TERM` | `PLAN_MONITOR` |
| `LOW` | *ä»»æ„* | `PLAN_MONITOR` |

**é»˜è®¤å€¼**: å¦‚æœæ²¡æœ‰åŒ¹é…ï¼Œé»˜è®¤ä¸º `PLAN_MONITOR`

### 3ï¸âƒ£ Liability Guardrailsï¼ˆè´£ä»»é£é™©ä¿æŠ¤è§„åˆ™ï¼‰

åœ¨åº”ç”¨ Liability è°ƒæ•´ä¹‹å‰ï¼Œæ£€æŸ¥ä¿æŠ¤è§„åˆ™ï¼š

- **å¦‚æœ `safety === HIGH`**: ä¸å…è®¸é™çº§ï¼ˆ`allow_downgrade: false`ï¼‰
- **å¦‚æœ `urgency === IMMEDIATE`**: ä¸å…è®¸ Liability è°ƒæ•´ï¼ˆ`allow_liability_adjustment: false`ï¼‰

### 4ï¸âƒ£ Liability Adjustmentï¼ˆè´£ä»»é£é™©è°ƒæ•´ï¼‰

**ä»…åœ¨ä»¥ä¸‹æƒ…å†µç”Ÿæ•ˆ**:
- ä¸åœ¨ Hard Overrides ä¸­
- `urgency !== IMMEDIATE`ï¼ˆå¦åˆ™è¢«ä¿æŠ¤è§„åˆ™é˜»æ­¢ï¼‰

**è°ƒæ•´è§„åˆ™**:

| Liability | Action | è¯´æ˜ |
|-----------|--------|------|
| `HIGH` | `shift: UP` | å¦‚æœå½“å‰æ˜¯ `PLAN_MONITOR` æˆ– `RECOMMENDED_0_3_MONTHS`ï¼Œæå‡åˆ° `RECOMMENDED_0_3_MONTHS`ï¼ˆæœ€é«˜ï¼‰ |
| `MEDIUM` | `shift: NONE` | ä¸è°ƒæ•´ |
| `LOW` | `shift: DOWN` | å¦‚æœå½“å‰æ˜¯ `RECOMMENDED_0_3_MONTHS` ä¸”å…è®¸é™çº§ï¼Œé™çº§åˆ° `PLAN_MONITOR` |

**ä»£ç ä½ç½®**: `netlify/functions/lib/rules.ts` çš„ `applyPriority()` å‡½æ•°

---

## ç¬¬ä¸‰æ­¥ï¼šç”ŸæˆæŠ¥å‘Š

æœ€ç»ˆä¼˜å…ˆçº§åˆ†ä¸ºä¸‰ç±»ï¼š

1. **IMMEDIATE**ï¼ˆç«‹å³å¤„ç†ï¼‰
   - éœ€è¦ç«‹å³å…³æ³¨çš„å®‰å…¨é—®é¢˜
   - é‚®ä»¶ä¸­æ˜¾ç¤ºä¸º "ğŸš¨ Immediate Attention Required"

2. **RECOMMENDED_0_3_MONTHS**ï¼ˆ0-3 ä¸ªæœˆå†…å»ºè®®å¤„ç†ï¼‰
   - å»ºè®®åœ¨çŸ­æœŸå†…å¤„ç†çš„é—®é¢˜
   - é‚®ä»¶ä¸­æ˜¾ç¤ºä¸º "âš ï¸ Recommended (0-3 months)"

3. **PLAN_MONITOR**ï¼ˆè®¡åˆ’/ç›‘æ§ï¼‰
   - å¯ä»¥é•¿æœŸè§„åˆ’æˆ–ç›‘æ§çš„é—®é¢˜
   - é‚®ä»¶ä¸­æ˜¾ç¤ºä¸º "ğŸ“‹ Plan / Monitor"

**ä»£ç ä½ç½®**: `netlify/functions/lib/rules.ts` çš„ `buildReportHtml()` å‡½æ•°

---

## ğŸ“Š å®Œæ•´æµç¨‹ç¤ºä¾‹

### ç¤ºä¾‹ 1: `SMOKE_ALARM_FAILURE`

1. **æå– Finding**: æ£€æŸ¥æ•°æ®è§¦å‘ `SMOKE_ALARM_FAILURE`
2. **æŸ¥æ‰¾ç»´åº¦**: 
   - Safety: `HIGH`
   - Urgency: `IMMEDIATE`
   - Liability: `HIGH`
3. **è®¡ç®—ä¼˜å…ˆçº§**:
   - âœ… åœ¨ Hard Overrides ä¸­ â†’ **ç›´æ¥è¿”å› `IMMEDIATE`**
4. **ç»“æœ**: `IMMEDIATE`

### ç¤ºä¾‹ 2: `PARTIAL_RCD_COVERAGE`

1. **æå– Finding**: æ£€æŸ¥æ•°æ®è§¦å‘ `PARTIAL_RCD_COVERAGE`
2. **æŸ¥æ‰¾ç»´åº¦**:
   - Safety: `MODERATE`
   - Urgency: `SHORT_TERM`
   - Liability: `HIGH`
3. **è®¡ç®—ä¼˜å…ˆçº§**:
   - âŒ ä¸åœ¨ Hard Overrides ä¸­
   - âœ… åŒ¹é…çŸ©é˜µ: `MODERATE + SHORT_TERM` â†’ `RECOMMENDED_0_3_MONTHS`
   - âœ… Urgency ä¸æ˜¯ `IMMEDIATE`ï¼Œå¯ä»¥åº”ç”¨ Liability è°ƒæ•´
   - âœ… Liability æ˜¯ `HIGH`ï¼Œå°è¯•æå‡ï¼Œä½†å·²ç»æ˜¯ `RECOMMENDED_0_3_MONTHS`ï¼ˆæœ€é«˜ï¼‰
4. **ç»“æœ**: `RECOMMENDED_0_3_MONTHS`

### ç¤ºä¾‹ 3: `LEGACY_EARTHING`

1. **æå– Finding**: æ£€æŸ¥æ•°æ®è§¦å‘ `LEGACY_EARTHING`
2. **æŸ¥æ‰¾ç»´åº¦**:
   - Safety: `MODERATE`
   - Urgency: `LONG_TERM`
   - Liability: `LOW`
3. **è®¡ç®—ä¼˜å…ˆçº§**:
   - âŒ ä¸åœ¨ Hard Overrides ä¸­
   - âœ… åŒ¹é…çŸ©é˜µ: `MODERATE + LONG_TERM` â†’ `PLAN_MONITOR`
   - âœ… Urgency ä¸æ˜¯ `IMMEDIATE`ï¼Œå¯ä»¥åº”ç”¨ Liability è°ƒæ•´
   - âœ… Liability æ˜¯ `LOW`ï¼Œå°è¯•é™çº§ï¼Œä½†å·²ç»æ˜¯ `PLAN_MONITOR`ï¼ˆæœ€ä½ï¼‰
4. **ç»“æœ**: `PLAN_MONITOR`

### ç¤ºä¾‹ 4: `SWITCH_ARCING`ï¼ˆå‡è®¾ä¿®æ”¹ä¸º MODERATE + SHORT_TERM + HIGHï¼‰

1. **æå– Finding**: æ£€æŸ¥æ•°æ®è§¦å‘ `SWITCH_ARCING`
2. **æŸ¥æ‰¾ç»´åº¦**:
   - Safety: `MODERATE`
   - Urgency: `SHORT_TERM`
   - Liability: `HIGH`
3. **è®¡ç®—ä¼˜å…ˆçº§**:
   - âŒ ä¸åœ¨ Hard Overrides ä¸­
   - âœ… åŒ¹é…çŸ©é˜µ: `MODERATE + SHORT_TERM` â†’ `RECOMMENDED_0_3_MONTHS`
   - âœ… Urgency ä¸æ˜¯ `IMMEDIATE`ï¼Œå¯ä»¥åº”ç”¨ Liability è°ƒæ•´
   - âœ… Liability æ˜¯ `HIGH`ï¼Œå°è¯•æå‡ï¼Œä½†å·²ç»æ˜¯ `RECOMMENDED_0_3_MONTHS`ï¼ˆæœ€é«˜ï¼‰
4. **ç»“æœ**: `RECOMMENDED_0_3_MONTHS`

---

## ğŸ”§ å¦‚ä½•ä¿®æ”¹åˆ¤æ–­é€»è¾‘

### ä¿®æ”¹ Finding çš„ç»´åº¦ï¼ˆSafety/Urgency/Liabilityï¼‰

1. è®¿é—® `/admin/rules`
2. åœ¨ **"å¯è§†åŒ–ç¼–è¾‘"** æ ‡ç­¾é¡µæ‰¾åˆ°å¯¹åº”çš„ Finding
3. ä¿®æ”¹ä¸‰ä¸ªä¸‹æ‹‰åˆ—è¡¨çš„å€¼
4. ç‚¹å‡» **"æ›´æ–°æ‰€æœ‰ Findings"**

### ä¿®æ”¹ Hard Overrides

1. åˆ‡æ¢åˆ° **"YAML ç¼–è¾‘å™¨"** æ ‡ç­¾é¡µ
2. æ‰¾åˆ° `hard_overrides.findings` éƒ¨åˆ†
3. æ·»åŠ æˆ–åˆ é™¤ Finding ID
4. ç‚¹å‡» **"Save Rules"**

### ä¿®æ”¹ Priority Matrix

1. åœ¨ **"YAML ç¼–è¾‘å™¨"** ä¸­æ‰¾åˆ° `base_priority_matrix`
2. ä¿®æ”¹ `when` æ¡ä»¶å’Œ `then` ç»“æœ
3. ç‚¹å‡» **"Save Rules"**

### ä¿®æ”¹ Liability Adjustment

1. åœ¨ **"YAML ç¼–è¾‘å™¨"** ä¸­æ‰¾åˆ° `liability_adjustment.rules`
2. ä¿®æ”¹ `when.liability` å’Œ `action` è§„åˆ™
3. ç‚¹å‡» **"Save Rules"**

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **Hard Overrides ä¼˜å…ˆçº§æœ€é«˜**: ä¸€æ—¦åœ¨åˆ—è¡¨ä¸­ï¼Œæ— è®ºå…¶ä»–ç»´åº¦å¦‚ä½•ï¼Œéƒ½æ˜¯ `IMMEDIATE`
2. **Safety HIGH çš„ä¿æŠ¤**: Safety ä¸º `HIGH` æ—¶ï¼Œä¸å…è®¸é€šè¿‡ Liability é™çº§
3. **Urgency IMMEDIATE çš„ä¿æŠ¤**: Urgency ä¸º `IMMEDIATE` æ—¶ï¼Œä¸å…è®¸åº”ç”¨ Liability è°ƒæ•´
4. **Liability è°ƒæ•´é™åˆ¶**: 
   - `UP` æœ€é«˜åªèƒ½åˆ° `RECOMMENDED_0_3_MONTHS`ï¼ˆä¸èƒ½è¶…è¿‡ï¼‰
   - `DOWN` æœ€ä½åªèƒ½åˆ° `PLAN_MONITOR`ï¼ˆä¸èƒ½æ›´ä½ï¼‰

---

## ğŸ” è°ƒè¯•å»ºè®®

å¦‚æœæŸä¸ª Finding çš„ä¼˜å…ˆçº§ä¸ç¬¦åˆé¢„æœŸï¼š

1. æ£€æŸ¥æ˜¯å¦åœ¨ `hard_overrides.findings` ä¸­ï¼ˆå¦‚æœæ˜¯ï¼Œç›´æ¥æ˜¯ `IMMEDIATE`ï¼‰
2. æ£€æŸ¥ Safety å’Œ Urgency æ˜¯å¦åŒ¹é… `base_priority_matrix` ä¸­çš„è§„åˆ™
3. æ£€æŸ¥ Liability è°ƒæ•´æ˜¯å¦è¢«ä¿æŠ¤è§„åˆ™é˜»æ­¢
4. æŸ¥çœ‹ Netlify Functions æ—¥å¿—ï¼ŒæŸ¥çœ‹å®é™…è®¡ç®—è¿‡ç¨‹

---

## ğŸ“š ç›¸å…³æ–‡ä»¶

- **è§„åˆ™å®šä¹‰**: `rules.yml` æˆ– `netlify/functions/lib/rules.ts` ä¸­çš„ `EMBEDDED_RULES_YAML`
- **Finding æå–**: `netlify/functions/lib/rules.ts` â†’ `factsToFindings()`
- **ä¼˜å…ˆçº§è®¡ç®—**: `netlify/functions/lib/rules.ts` â†’ `applyPriority()`
- **æŠ¥å‘Šç”Ÿæˆ**: `netlify/functions/lib/rules.ts` â†’ `buildReportHtml()`
